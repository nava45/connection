<!-- extend base layout -->
{% extends "base.html" %}

{% block content %}

<script type="text/javascript">

function set_openid(openid, pr)
{
    u = openid.search('<username>');
    if (u != -1) {
        // openid requires username
        user = prompt('Enter your ' + pr + ' username:');
        openid = openid.substr(0, u) + user;
    }
    form = document.forms['login'];
    form.elements['openid'].value = openid;
}

function ajax_login(openid, provider) {
   
	u = openid.search('<username>');
    if (u != -1) {
        // openid requires username
        user = prompt('Enter your ' + pr + ' username:');
        openid = openid.substr(0, u) + user;
    }

	//form = document.forms['login'];
    //form.elements['openid'].value = openid;

    var request = $.post('/login', {
        openid: openid,
		provider: provider
    });
	request.done(function(result) {
        	alert('success!!');
   	 });
	request.fail(function() {
        	alert('Fail!!');
    	});
}

$(document).ready(function() {
	
  $("#async_login").click(function() {
	alert('clicked!!');
	ajax_login('Google','Google');
	});
});

</script>

{% include "flash.html" %}

<div class="well">
    <h3>{{ 'Please Sign In' }}</h3>
        <div class="help-block">{{ 'Click on your OpenID provider below:' }}</div>
        <div class="control-group">
            {% for pr in providers %}
            <a href="javascript:ajax_login('{{pr.url}}', '{{pr.name}}');"><img src="/static/images/{{pr.name.lower()}}.png" class="img-polaroid" style="margin:2px;" /></a>
            {% endfor %}
        </div>
		<form name="login" method="post">
		
		</form>     

</div>
{% endblock %}
